// ServeSync - Restaurant Order Management System
// Prisma Schema for backend services

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// User model for authentication and role management
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  role      Role     @default(CUSTOMER)
  phone     String?
  avatar    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  orders     Order[]
  restaurant Restaurant?
  reviews    Review[]

  // Auth fields
  resetPasswordToken   String?
  resetPasswordExpires DateTime?

  @@map("users")
}

// Role enum for different user types
enum Role {
  CUSTOMER
  KITCHEN
  ADMIN
}

// Restaurant model
model Restaurant {
  id        String   @id @default(cuid())
  name      String
  address   String
  phone     String?
  email     String?
  image     String?
  userId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  menuItems MenuItem[]
  orders    Order[]

  @@map("restaurants")
}

// MenuItem model for menu management
model MenuItem {
  id           String   @id @default(cuid())
  name         String
  description  String?
  price        Float
  category     String
  image        String?
  available    Boolean  @default(true)
  restaurantId String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  restaurant Restaurant  @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  orderItems OrderItem[]

  @@index([restaurantId])
  @@map("menu_items")
}

// Order model for managing customer orders
model Order {
  id           String      @id @default(cuid())
  status       OrderStatus @default(PENDING)
  total        Float
  customerId   String
  restaurantId String
  notes        String?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  // Relations
  customer   User        @relation(fields: [customerId], references: [id], onDelete: Cascade)
  restaurant Restaurant  @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  items      OrderItem[]
  payment    Payment?
  delivery   Delivery?

  @@index([customerId])
  @@index([restaurantId])
  @@map("orders")
}

// OrderItem model for order line items
model OrderItem {
  id         String  @id @default(cuid())
  orderId    String
  menuItemId String
  quantity   Int
  price      Float
  notes      String?

  // Relations
  order    Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  menuItem MenuItem @relation(fields: [menuItemId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([menuItemId])
  @@map("order_items")
}

// Order status enum
enum OrderStatus {
  PENDING
  CONFIRMED
  PREPARING
  READY
  OUT_FOR_DELIVERY
  DELIVERED
  CANCELLED
}

// Payment model for payment processing
model Payment {
  id              String        @id @default(cuid())
  orderId         String        @unique
  amount          Float
  paymentMethod   PaymentMethod
  status          PaymentStatus @default(PENDING)
  stripeSessionId String?
  transactionId   String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  // Relations
  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("payments")
}

// Payment method enum
enum PaymentMethod {
  CREDIT_CARD
  DEBIT_CARD
  PAYPAL
  STRIPE
  CASH
  WALLET
}

// Payment status enum
enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
}

// Delivery model for tracking deliveries
model Delivery {
  id            String         @id @default(cuid())
  orderId       String         @unique
  status        DeliveryStatus @default(PENDING)
  address       String
  latitude      Float?
  longitude     Float?
  estimatedTime DateTime?
  actualTime    DateTime?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  // Relations
  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("deliveries")
}

// Delivery status enum
enum DeliveryStatus {
  PENDING
  ASSIGNED
  IN_TRANSIT
  DELIVERED
  FAILED
}

// Review model for customer reviews
model Review {
  id        String   @id @default(cuid())
  userId    String
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("reviews")
}
